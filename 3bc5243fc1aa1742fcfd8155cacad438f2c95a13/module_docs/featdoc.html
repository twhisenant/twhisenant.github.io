
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Feature Extraction &#8212; DataCloud Rhino 1.0 documentation</title>
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Plotting Data" href="plotdoc.html" />
    <link rel="prev" title="Python Helpers" href="featdir.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="plotdoc.html" title="Plotting Data"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="featdir.html" title="Python Helpers"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">DataCloud Rhino 1.0 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="feature-extraction">
<h1>Feature Extraction<a class="headerlink" href="#feature-extraction" title="Permalink to this headline">¶</a></h1>
<div class="section" id="extraction">
<h2>Extraction<a class="headerlink" href="#extraction" title="Permalink to this headline">¶</a></h2>
<div class="section" id="k0-extractor">
<h3>k0 Extractor<a class="headerlink" href="#k0-extractor" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><span class="target" id="module-feature_extractor_k0"></span><p>Author: kkappler</p>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last">remove explicit declaration of ACOUSTIC_VELOCITY, and replace with
value from global_config</p>
</div>
<dl class="class">
<dt id="feature_extractor_k0.FeatureExtractorK0">
<em class="property">class </em><code class="descname">FeatureExtractorK0</code><span class="sig-paren">(</span><em>component_id</em>, <em>trimmed_trace</em>, <em>transformed_args</em>, <em>timestamp</em><span class="sig-paren">)</span><a class="headerlink" href="#feature_extractor_k0.FeatureExtractorK0" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="feature_extractor_k0.FeatureExtractorK0.populate_window_data_dict">
<code class="descname">populate_window_data_dict</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#feature_extractor_k0.FeatureExtractorK0.populate_window_data_dict" title="Permalink to this definition">¶</a></dt>
<dd><p>Associate with each window_label, the data in that window, and the time
takes a dictionary of times as input.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">a dictionary of same keys, but [ndx0, ndx1] replaced by data_series</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">(dict)</td>
</tr>
</tbody>
</table>
<div class="admonition-todo admonition" id="index-1">
<p class="first admonition-title">Todo</p>
<p class="last">Spruce this up by using iterative dictionary comprehension</p>
</div>
<div class="admonition-todo admonition" id="index-2">
<p class="first admonition-title">Todo</p>
<p class="last">time vector splitting is redundant -  calulate once outside here?</p>
</div>
</dd></dl>

<dl class="method">
<dt id="feature_extractor_k0.FeatureExtractorK0.extract_features_from_each_window">
<code class="descname">extract_features_from_each_window</code><span class="sig-paren">(</span><em>window_data_dict</em>, <em>time_vector_dict</em><span class="sig-paren">)</span><a class="headerlink" href="#feature_extractor_k0.FeatureExtractorK0.extract_features_from_each_window" title="Permalink to this definition">¶</a></dt>
<dd><p>Feature extractor that moves window by window, finds features, and
stores them under window label. Calc’s the following and gives them to
<a class="reference internal" href="#intermediate_derived_features.IntermediateFeatureDeriver" title="intermediate_derived_features.IntermediateFeatureDeriver"><code class="xref py py-class docutils literal notranslate"><span class="pre">IntermediateFeatureDeriver</span></code></a>.</p>
<blockquote>
<div><ul class="simple">
<li>max_amplitude</li>
<li>max_time</li>
<li>min_amplitude</li>
<li>min_time</li>
<li>integrated_absolute_amplitude</li>
</ul>
</div></blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>window_data_dict</strong> (<em>dict</em>) – window labels, time_boundaries dictionary</li>
<li><strong>time_vector_dict</strong> (<em>dict</em>) – dictionary of time_vectors for each window_label</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">dictionary (unnested) from <a class="reference internal" href="#intermediate_derived_features.IntermediateFeatureDeriver" title="intermediate_derived_features.IntermediateFeatureDeriver"><code class="xref py py-class docutils literal notranslate"><span class="pre">IntermediateFeatureDeriver</span></code></a></p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">(dict)</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition-todo admonition" id="index-3">
<p class="first admonition-title">Todo</p>
<p class="last">20190218: this is the old way to handle this …</p>
</div>
</dd></dl>

<dl class="method">
<dt id="feature_extractor_k0.FeatureExtractorK0.extract_features">
<code class="descname">extract_features</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#feature_extractor_k0.FeatureExtractorK0.extract_features" title="Permalink to this definition">¶</a></dt>
<dd><p>Conducts the feature_extractor_k0 to set_window_boundaries, extract features,
and output a dictionary of extracted features.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">unnested dictionary of extracted/derived features from <a class="reference internal" href="#intermediate_derived_features.IntermediateFeatureDeriver" title="intermediate_derived_features.IntermediateFeatureDeriver"><code class="xref py py-class docutils literal notranslate"><span class="pre">IntermediateFeatureDeriver</span></code></a></td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">(dict)</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div></blockquote>
</div>
<div class="section" id="j1a-extractor">
<h3>j1a Extractor<a class="headerlink" href="#j1a-extractor" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><span class="target" id="module-feature_extractor_j1a"></span><p>Author kkapler</p>
<div class="admonition-todo admonition" id="index-4">
<p class="first admonition-title">Todo</p>
<p class="last">remove explicit declaration of ACOUSTIC_VELOCITY, and replace with
value from global_config</p>
</div>
<dl class="function">
<dt id="feature_extractor_j1a.test_populate_window_data_dict">
<code class="descname">test_populate_window_data_dict</code><span class="sig-paren">(</span><em>trace_data_window_dict</em>, <em>trace_time_vector_dict</em>, <em>trimmed_trace</em>, <em>trimmed_time_vector</em><span class="sig-paren">)</span><a class="headerlink" href="#feature_extractor_j1a.test_populate_window_data_dict" title="Permalink to this definition">¶</a></dt>
<dd><p>Plot the trace in black line and multicolor scatter, label axis/legend, show.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>trace_data_window_dict</strong> (<em>dict</em>) – trace data</li>
<li><strong>trace_time_vector_dict</strong> (<em>dict</em>) – trace time data</li>
<li><strong>trimmed_trace</strong> – 1D trace data (to be plotted)</li>
<li><strong>trimmed_time_vector</strong> – 1D trace time data (to be plotted)</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="feature_extractor_j1a.calculate_boolean_features">
<code class="descname">calculate_boolean_features</code><span class="sig-paren">(</span><em>feature_dict</em>, <em>sensor_saturation_g</em><span class="sig-paren">)</span><a class="headerlink" href="#feature_extractor_j1a.calculate_boolean_features" title="Permalink to this definition">¶</a></dt>
<dd><p>Create Boolean and configure calculation for feature extraction, Output dictionary
contains the following boolean values:</p>
<blockquote>
<div><ul class="simple">
<li>mask_system_noise_level</li>
<li>mask_snr_mult1</li>
</ul>
</div></blockquote>
<p>Based on:</p>
<div class="line-block">
<div class="line">1 Min = sensitivity (g) /2000</div>
<div class="line">2 S/N 1st Multiple &gt; 1</div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feature_dict</strong> (<em>dict</em>) – feature dictionary</li>
<li><strong>sensor_saturation_g</strong> (<em>float</em>) – sensor saturation value</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">dictionary of booleans to be usedin feature extraction</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">(dict)</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">feature_dict here is a subdictionary, we are working with a single component</p>
</div>
</dd></dl>

<dl class="class">
<dt id="feature_extractor_j1a.FeatureExtractorJ1">
<em class="property">class </em><code class="descname">FeatureExtractorJ1</code><span class="sig-paren">(</span><em>component_id</em>, <em>trimmed_trace</em>, <em>transformed_args</em>, <em>timestamp</em><span class="sig-paren">)</span><a class="headerlink" href="#feature_extractor_j1a.FeatureExtractorJ1" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="feature_extractor_j1a.FeatureExtractorJ1.set_time_window_boundaries">
<code class="descname">set_time_window_boundaries</code><span class="sig-paren">(</span><em>primary_shift=0.0</em><span class="sig-paren">)</span><a class="headerlink" href="#feature_extractor_j1a.FeatureExtractorJ1.set_time_window_boundaries" title="Permalink to this definition">¶</a></dt>
<dd><p>Set times based on window widths and the expected multiple periods, associate
the start and end times of each window with a label in a dictionary.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last"><strong>Requires</strong> that primary and multiple be defined BEFORE noise
i.e. the order of  elements in TRACE_WINDOW_LABELS_FOR_FEATURE_EXTRACTION
is important!!!</p>
</div>
<div class="admonition-todo admonition" id="index-5">
<p class="first admonition-title">Todo</p>
<p class="last">Test assignments working properly through window_boundaries_time_dict</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">Other Parameters:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body"><strong>primary_shift</strong> (<em>float</em>) – offset of primary wave</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="feature_extractor_j1a.FeatureExtractorJ1.convert_time_window_to_indices">
<code class="descname">convert_time_window_to_indices</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#feature_extractor_j1a.FeatureExtractorJ1.convert_time_window_to_indices" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts time window to set of indices containing values in for that time.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">this seems to work for +ve and -ve times</p>
</div>
</dd></dl>

<dl class="method">
<dt id="feature_extractor_j1a.FeatureExtractorJ1.update_window_boundaries_in_time">
<code class="descname">update_window_boundaries_in_time</code><span class="sig-paren">(</span><em>dynamic_windows=['primary']</em><span class="sig-paren">)</span><a class="headerlink" href="#feature_extractor_j1a.FeatureExtractorJ1.update_window_boundaries_in_time" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the window boundaries if dynamic windows is true. Grab the primary
trace and find its max, make sure this is no more than a few samples from
t=0, adjust window_boundaries_time to new times, then adjust the indices</p>
<p><strong>Dynamic Window Allocation</strong> idea is that the primary window will depend on
the data, not an predetermined expected window assignment
window_boundaries_time, window_boundaries_indices = update_window_boundaries(trimmed_trace,
trimmed_time_vector, window_boundaries_time, window_boundaries_indices)</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">acceptable_peak_wander = .003 #3ms</p>
</div>
<p class="rubric">References</p>
<p>applicable_window_width, for which I need to know what component I am on</p>
</dd></dl>

<dl class="method">
<dt id="feature_extractor_j1a.FeatureExtractorJ1.populate_window_data_dict">
<code class="descname">populate_window_data_dict</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#feature_extractor_j1a.FeatureExtractorJ1.populate_window_data_dict" title="Permalink to this definition">¶</a></dt>
<dd><p>Associate with each window_label, the data in that window, and the time
takes a dictionary of times as input.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">a dictionary of same keys, but [ndx0, ndx1] replaced by data_series</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">(dict)</td>
</tr>
</tbody>
</table>
<div class="admonition-todo admonition" id="index-6">
<p class="first admonition-title">Todo</p>
<p class="last">Spruce this up by using iterative dictionary comprehension</p>
</div>
<div class="admonition-todo admonition" id="index-7">
<p class="first admonition-title">Todo</p>
<p class="last">time vector splitting is redundant -  calulate once outside here?</p>
</div>
</dd></dl>

<dl class="method">
<dt id="feature_extractor_j1a.FeatureExtractorJ1.extract_features_from_each_window">
<code class="descname">extract_features_from_each_window</code><span class="sig-paren">(</span><em>window_data_dict</em>, <em>time_vector_dict</em><span class="sig-paren">)</span><a class="headerlink" href="#feature_extractor_j1a.FeatureExtractorJ1.extract_features_from_each_window" title="Permalink to this definition">¶</a></dt>
<dd><p>Feature extractor that moves window by window, finds features, and
stores them under window label. Calc’s the following and gives them to
<a class="reference internal" href="#intermediate_derived_features.IntermediateFeatureDeriver" title="intermediate_derived_features.IntermediateFeatureDeriver"><code class="xref py py-class docutils literal notranslate"><span class="pre">IntermediateFeatureDeriver</span></code></a>.</p>
<blockquote>
<div><ul class="simple">
<li>max_amplitude</li>
<li>max_time</li>
<li>min_amplitude</li>
<li>min_time</li>
<li>integrated_absolute_amplitude</li>
</ul>
</div></blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>window_data_dict</strong> (<em>dict</em>) – window labels, time_boundaries dictionary</li>
<li><strong>time_vector_dict</strong> (<em>dict</em>) – dictionary of time_vectors for each window_label</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">dictionary (unnested) from <a class="reference internal" href="#intermediate_derived_features.IntermediateFeatureDeriver" title="intermediate_derived_features.IntermediateFeatureDeriver"><code class="xref py py-class docutils literal notranslate"><span class="pre">IntermediateFeatureDeriver</span></code></a></p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">(dict)</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="feature_extractor_j1a.FeatureExtractorJ1.extract_features">
<code class="descname">extract_features</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#feature_extractor_j1a.FeatureExtractorJ1.extract_features" title="Permalink to this definition">¶</a></dt>
<dd><p>Conducts the feature_extractor_j1a to set_window_boundaries, extract features,
and output a dictionary of extracted features.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">dictionary of extracted features from <a class="reference internal" href="#feature_extractor_j1a.FeatureExtractorJ1.extract_features_from_each_window" title="feature_extractor_j1a.FeatureExtractorJ1.extract_features_from_each_window"><code class="xref py py-func docutils literal notranslate"><span class="pre">extract_features_from_each_window()</span></code></a></td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">(dict)</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">now that we are operating by component we could skip the new_features_dict
and flatten step, and instead add the component id explicity in L303…</p>
</div>
</dd></dl>

</dd></dl>

</div></blockquote>
</div>
<div class="section" id="j0-extractor">
<h3>j0 Extractor<a class="headerlink" href="#j0-extractor" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><span class="target" id="module-feature_extractor_j0"></span><p>Author: kkapler</p>
<div class="admonition-todo admonition" id="index-8">
<p class="first admonition-title">Todo</p>
<p class="last">remove explicit declaration of ACOUSTIC_VELOCITY, and replace with
value from global_config</p>
</div>
<dl class="class">
<dt id="feature_extractor_j0.FeatureExtractorJ0">
<em class="property">class </em><code class="descname">FeatureExtractorJ0</code><span class="sig-paren">(</span><em>transformed_args</em><span class="sig-paren">)</span><a class="headerlink" href="#feature_extractor_j0.FeatureExtractorJ0" title="Permalink to this definition">¶</a></dt>
<dd><p>Extracts features from trace to make predictions downstream.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>transformed_args</strong> (<em>Dataframe</em>) – contains drilling values (ex. ‘output_sampling_rate’)</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The declaration of min_lag_trimmed_trace as its absolute
value is not good form:  np.abs(transformed_args.min_lag_trimmed_trace)</p>
</div>
<dl class="method">
<dt id="feature_extractor_j0.FeatureExtractorJ0.get_earliest_expected_mulitple_time">
<code class="descname">get_earliest_expected_mulitple_time</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#feature_extractor_j0.FeatureExtractorJ0.get_earliest_expected_mulitple_time" title="Permalink to this definition">¶</a></dt>
<dd><p>Use idealized, theoretical two way travel time to find the <em>earliest time</em>
a multiple wave could arrive at the sensor.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">the earliest multiple arrival time (relative to primary peak time)</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">(float)</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">to be deprecated and replaced by supporting_j1.get_expected_multiple_times()</p>
</div>
</dd></dl>

<dl class="method">
<dt id="feature_extractor_j0.FeatureExtractorJ0.create_features_dictionary">
<code class="descname">create_features_dictionary</code><span class="sig-paren">(</span><em>component_id</em><span class="sig-paren">)</span><a class="headerlink" href="#feature_extractor_j0.FeatureExtractorJ0.create_features_dictionary" title="Permalink to this definition">¶</a></dt>
<dd><p>Create dictionary of features for component_id (axial/tangential).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>component_id</strong> (<em>str</em>) – axial/tangential</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Dictionary with feature_string to be filled with feature values</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">(dict)</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="feature_extractor_j0.FeatureExtractorJ0.extract_features">
<code class="descname">extract_features</code><span class="sig-paren">(</span><em>component_id</em>, <em>component_array</em>, <em>trace_timestamp</em>, <em>transformed_args</em><span class="sig-paren">)</span><a class="headerlink" href="#feature_extractor_j0.FeatureExtractorJ0.extract_features" title="Permalink to this definition">¶</a></dt>
<dd><p>Create features dictionary, extract features, derive features, output dictionary
of derived features. Requires <code class="xref py py-class docutils literal notranslate"><span class="pre">IntermediateFeatureDeriver</span></code></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>component_id</strong> (<em>str</em>) – axial/tangential</li>
<li><strong>component_array</strong> (<em>array</em>) – trace data on along one component</li>
<li><strong>transformed_args</strong> (<em>Dataframe</em>) – contains drilling values (ex. ‘output_sampling_rate’)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">dictionary of derived features from intermediate feature deriver</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">(dict)</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">min lag has an ambiguity in sign</p>
</div>
</dd></dl>

</dd></dl>

</div></blockquote>
</div>
<div class="section" id="b0-extractor">
<h3>b0 Extractor<a class="headerlink" href="#b0-extractor" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><span class="target" id="module-feature_extractor_b0"></span><p>Author kkappler</p>
<dl class="function">
<dt id="feature_extractor_b0.feature_extractor_b0">
<code class="descname">feature_extractor_b0</code><span class="sig-paren">(</span><em>component_id</em>, <em>trimmed_trace</em>, <em>transformed_args</em>, <em>timestamp</em><span class="sig-paren">)</span><a class="headerlink" href="#feature_extractor_b0.feature_extractor_b0" title="Permalink to this definition">¶</a></dt>
<dd><p>Most basic feature extractor, which outputs a dictionary with values for the keys:</p>
<blockquote>
<div><ul class="simple">
<li>rotation_angle</li>
<li>max_amplitude</li>
<li>max_time</li>
</ul>
</div></blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>component_id</strong> (<em>str</em>) – axial/tangential</li>
<li><strong>trimmed_trace</strong> (<em>array</em>) – trace data (trimmed by amount of time from primary peak)</li>
<li><strong>transformed_args</strong> (<em>Dataframe</em>) – contains drilling values (ex. ‘output_sampling_rate’)</li>
<li><strong>timestamp</strong> – used for logger.error if no peaks detected</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">outputs dictionary with keys=feature names : values=location of features</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">(dict)</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div></blockquote>
</div>
</div>
<div class="section" id="derivation">
<h2>Derivation<a class="headerlink" href="#derivation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="external">
<h3>External<a class="headerlink" href="#external" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><span class="target" id="module-external_feature_derivations"></span><p>Created on Tue Dec 18 19:29:08 2018</p>
<p>&#64;author: kkappler</p>
<dl class="class">
<dt id="external_feature_derivations.DerivedFeatureExtractorV0">
<em class="property">class </em><code class="descname">DerivedFeatureExtractorV0</code><span class="sig-paren">(</span><em>df</em><span class="sig-paren">)</span><a class="headerlink" href="#external_feature_derivations.DerivedFeatureExtractorV0" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes as input the extracted features dataframe (or csv-loads)
and calcualtes the derived features;
May factor this into axial, tangential but for now do as all-one
a_delay
a_dens
a_mod
a_reflection_coefficient
a_vel
a_str
c_modulus
c_strength
c_velocity
density
Error_Flag
hole_id
QC_FLAG
s_modulus
s_velocity
t_delay
t_mod
t_reflection_coef
a_delay:  a_delay = axial_multiple_peak_time_sample - axial_primary_peak_time_sample</p>
<p>This formula resulted in a ‘blocky’ looking log because the sample-granularity
that was applied resulted in only a few discrete values being observed.
Variation over a blasthole was often only observed to have three or four
distinct values.  When smoothing was applied to these logs they looked
somewhat plausible.  We can reduce the blockyness by using
axial_multiple_peak_time_poly, and axial_primary_peak_time_poly, i.e.
the polyfit critical points rather than those at sample granularity.</p>
<p>a_dens:  a_reflection_coef / a_vel^2
Previously known as “pseudo_density”, we have been calculating it as:
a_dens = reflection_coefficient_sample / primary_pseudo_velocity_sample**2
Where the primary_pseudo_velocity_sample = 1. / self.primary_wavelet_width_sample
Which can be expressed as
a_dens = reflection_coefficient_sample * self.primary_wavelet_width_sample**2
N.B.: this used primary_wavelet_width_sample which has been suggested is not a valid measurement:  For the record:
primary_wavelet_width_sample = axial_primary_zero_crossing_after_sample - axial_primary_left_trough_time</p>
<p>a_mod:  k1 * a_reflection_coef
Not previously calculated, just plotted as reflection_coef, i.e. k1=1.0;
k1 a constant to be determined; may depend on MWD</p>
<p>a_reflection_coef: (1-R) / (1+R)
where R is the multiple-to-primary-amplitude ratio (axial)</p>
<p>a_str:  sqrt(self.axial_primary_peak_sample)
Previously known as pseudo_ucs;  We looked at logs of this quantity with
_sample resolution vs _poly (polynomail fit) and found little difference to
first order behaviour.</p>
<p>a_vel:  1 / a_delay
This is the “delay velocity”.  It is the one that has been ‘blocky’ in the past</p>
<p>c_density:  This will be some scaled version of a_dens, for now we set equal to a_dens
c_modulus:  This will be some scaled version of a_mod, for now we set equal to a_mod
c_strength:  This will be some scaled version of a_str, for now we set equal to a_str
c_velocity:  This will be some scaled version of a_vel, for now we set equal to a_vel</p>
<p>t_delay:   tangential_delay = tangential_multiple1_time_poly - tangential_primary_time_poly
Here we are using polynomial fits so we are not so ‘blocky’.  The label for this feature is 1810_tangential_delay</p>
<p>t_mod:  k2 * t_reflection_coef
Not previously calculated, k2 a constant to be determined; may depend on MWD</p>
<p>t_reflection_coef: (1-R) / (1+R) where R is the multiple-to-primary-amplitude ratio (tangential)</p>
<p>tangential_amplitude_ratio’ =  features[‘tangential_multiple1_amplitude_poly’] / ‘tangential_primary_amplitude_poly’]</p>
<p>t_vel:  1 / t_delay</p>
<p>s_modulus: This will be some scaled version of t_mod, for now we set equal to t_mod</p>
<p>s_velocity :This will be some scaled version of s_vel, for now we set equal to s_vel</p>
<dl class="attribute">
<dt id="external_feature_derivations.DerivedFeatureExtractorV0.a_delay">
<code class="descname">a_delay</code><a class="headerlink" href="#external_feature_derivations.DerivedFeatureExtractorV0.a_delay" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates the time delay between axial primary peak and axial multiple
peak. This is the “delay velocity”.  It is the one that has been
‘blocky’ in the past</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>None</strong> – </p>
</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">Other Parameters:</th></tr>
<tr class="field-even field"><td>&#160;</td><td class="field-body"><ul class="first simple">
<li><strong>feature version</strong> (<em>str</em>) – version of extractor deriver (here: ‘J0’)</li>
<li><strong>axial_primary_peak_time_sample</strong> (<em>float</em>) – time of the axial
primary peak from dataframe “df”</li>
<li><strong>axial_multiple_peak_time_sample</strong> (<em>float</em>) – time of the axial
multiple peak from datafram “df”</li>
</ul>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><dl class="docutils">
<dt><strong>a_delay</strong>, the time delay between axial primary peak and</dt>
<dd><p class="first last">multiple peak</p>
</dd>
</dl>
</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">(float)</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In v1 this feature was calculated in direct features;
extracted_features_df[‘axial_delay’] =
extracted_features_df[‘axial_multiple_peak_time_sample’] -
extracted_features_df[‘axial_primary_peak_time_sample’]
Now we calc as a derived feature.</p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="external_feature_derivations.DerivedFeatureExtractorV0.a_amplitude_ratio">
<code class="descname">a_amplitude_ratio</code><a class="headerlink" href="#external_feature_derivations.DerivedFeatureExtractorV0.a_amplitude_ratio" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates the ratio between the primary peak amplitude and the
multiple peak amplitude.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>None</strong> – </p>
</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">Other Parameters:</th></tr>
<tr class="field-even field"><td>&#160;</td><td class="field-body"><ul class="first last simple">
<li><strong>feature version</strong> (<em>str</em>) – version of extractor deriver (here: ‘J0’)</li>
<li><strong>axial_primary_peak_sample</strong> (<em>float</em>) – value of primary peak amplitude
from dataframe “df”</li>
<li><strong>axial_multiple_peak_sample</strong> (<em>float</em>) – value of multiple peak amplitude
from dataframe “df”</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>Returns</dt>
<dd>(float): <strong>a_amplitude_ratio</strong>, the ratio between the primary peak
amplitude and the multiple peak amplitude</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="external_feature_derivations.DerivedFeatureExtractorV0.a_str">
<code class="descname">a_str</code><a class="headerlink" href="#external_feature_derivations.DerivedFeatureExtractorV0.a_str" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates the square root of the axial primary peak amplitude. Previously
known as pseudo_ucs;  We looked at logs of this quantity with _sample
resolution vs _poly (polynomail fit) and found little difference to
first order behaviour.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>None</strong> – </p>
</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">Other Parameters:</th></tr>
<tr class="field-even field"><td>&#160;</td><td class="field-body"><ul class="first simple">
<li><strong>feature version</strong> (<em>str</em>) – version of extractor deriver (here: ‘J0’)</li>
<li><strong>axial_primary_peak_sample</strong> (<em>float</em>) – the primary peak amplitude from
the dataframe “df”</li>
</ul>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>a_str</strong>, the sqrt of the axial primary peak amplitude</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">(float)</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="external_feature_derivations.DerivedFeatureExtractorV0.a_vel">
<code class="descname">a_vel</code><a class="headerlink" href="#external_feature_derivations.DerivedFeatureExtractorV0.a_vel" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates the relative velocity of the axial wave using the inverse of
a_delay. This is the “delay velocity”.  It is the one that has been ‘blocky’
in the past</p>
<blockquote>
<div><div class="line-block">
<div class="line">a_vel:  1 / a_delay</div>
</div>
</div></blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>None</strong> – </p>
</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">Other Parameters:</th></tr>
<tr class="field-even field"><td>&#160;</td><td class="field-body"><ul class="first simple">
<li><strong>feature version</strong> (<em>str</em>) – version of extractor deriver (here: ‘J0’)</li>
<li><strong>a_delay</strong> (<em>float</em>) – calculated in <code class="xref py py-meth docutils literal notranslate"><span class="pre">a_delay()</span></code></li>
</ul>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>a_vel</strong>, the delay velocity calculated from the axial component</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">(float)</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This does not take into account the distance from instrument
to tip, so this is not absolute velocity</p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="external_feature_derivations.DerivedFeatureExtractorV0.a_reflection_coef">
<code class="descname">a_reflection_coef</code><a class="headerlink" href="#external_feature_derivations.DerivedFeatureExtractorV0.a_reflection_coef" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates the reflection coefficient between the drill/rock interface
from the axial primary and multiple peaks.</p>
<div class="line-block">
<div class="line">a_reflection_coef: (1-R) / (1+R)</div>
</div>
<p>Where R is the multiple-to-primary-amplitude ratio (axial)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>None</strong> – </td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">Other Parameters:</th></tr>
<tr class="field-even field"><td>&#160;</td><td class="field-body"><strong>a_amplitude_ratio</strong> (<em>float</em>) – calculated in <code class="xref py py-meth docutils literal notranslate"><span class="pre">a_amplitude_ratio()</span></code></td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">the reflection coefficient from axial component features</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">(float)</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="external_feature_derivations.DerivedFeatureExtractorV0.a_mod">
<code class="descname">a_mod</code><a class="headerlink" href="#external_feature_derivations.DerivedFeatureExtractorV0.a_mod" title="Permalink to this definition">¶</a></dt>
<dd><p>Scales the reflection coefficient based on drill setup to find modulus,</p>
<div class="line-block">
<div class="line">a_mod = k1 * a_reflection_coef.</div>
</div>
<p>Not previously calculated, just plotted as reflection_coef, i.e. k1=1.0;
k1 a constant to be determined; may depend on MWD.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>None</strong> – </td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">Other Parameters:</th></tr>
<tr class="field-even field"><td>&#160;</td><td class="field-body"><strong>a_reflection_coef</strong> (<em>float</em>) – calculated in <code class="xref py py-meth docutils literal notranslate"><span class="pre">a_reflection_coef()</span></code></td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><strong>a_mod</strong>, the modulus from axial component features</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">(float)</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="external_feature_derivations.DerivedFeatureExtractorV0.a_dens">
<code class="descname">a_dens</code><a class="headerlink" href="#external_feature_derivations.DerivedFeatureExtractorV0.a_dens" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates density of rock based on reflection coefficient and velocity,
Previously known as “pseudo_density”.</p>
<div class="line-block">
<div class="line">We have been calculating it as:</div>
<div class="line-block">
<div class="line">a_dens = reflection_coefficient_sample / primary_pseudo_velocity_sample**2</div>
</div>
</div>
<div class="line-block">
<div class="line">Which can be expressed as:</div>
<div class="line-block">
<div class="line">a_dens = reflection_coefficient_sample * self.primary_wavelet_width_sample**2</div>
</div>
</div>
<div class="line-block">
<div class="line">N.B.: this used primary_wavelet_width_sample which has been suggested is not a valid measurement.</div>
<div class="line">For the record:</div>
<div class="line-block">
<div class="line">primary_wavelet_width_sample = axial_primary_zero_crossing_after_sample - axial_primary_left_trough_time</div>
</div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>None</strong> – </p>
</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">Other Parameters:</th></tr>
<tr class="field-even field"><td>&#160;</td><td class="field-body"><ul class="first simple">
<li><strong>a_reflection_coef</strong> (<em>float</em>) – calculated in <code class="xref py py-meth docutils literal notranslate"><span class="pre">a_reflection_coef()</span></code></li>
<li><strong>a_vel</strong> (<em>float</em>) – calculated in <code class="xref py py-meth docutils literal notranslate"><span class="pre">a_vel()</span></code></li>
</ul>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">the derived density of the rock surrounding drill head</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">(float)</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="external_feature_derivations.DerivedFeatureExtractorV0.c_density">
<code class="descname">c_density</code><a class="headerlink" href="#external_feature_derivations.DerivedFeatureExtractorV0.c_density" title="Permalink to this definition">¶</a></dt>
<dd><p>This will be some scaled version of a_dens, for now we set equal to a_dens</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body"><div class="admonition-todo first last admonition" id="index-9">
<p class="first admonition-title">Todo</p>
<p class="last">20181224</p>
</div>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="external_feature_derivations.DerivedFeatureExtractorV0.c_modulus">
<code class="descname">c_modulus</code><a class="headerlink" href="#external_feature_derivations.DerivedFeatureExtractorV0.c_modulus" title="Permalink to this definition">¶</a></dt>
<dd><p>This will be some scaled version of a_mod, for now we set equal to a_mod</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body"><div class="admonition-todo first last admonition" id="index-10">
<p class="first admonition-title">Todo</p>
<p class="last">20181224</p>
</div>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="external_feature_derivations.DerivedFeatureExtractorV0.c_strength">
<code class="descname">c_strength</code><a class="headerlink" href="#external_feature_derivations.DerivedFeatureExtractorV0.c_strength" title="Permalink to this definition">¶</a></dt>
<dd><p>This will be some scaled version of a_str, for now we set equal to a_str</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body"><div class="admonition-todo first last admonition" id="index-11">
<p class="first admonition-title">Todo</p>
<p class="last">20181224</p>
</div>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="external_feature_derivations.DerivedFeatureExtractorV0.c_velocity">
<code class="descname">c_velocity</code><a class="headerlink" href="#external_feature_derivations.DerivedFeatureExtractorV0.c_velocity" title="Permalink to this definition">¶</a></dt>
<dd><p>This will be some scaled version of a_vel, for now we set equal to a_vel</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body"><div class="admonition-todo first last admonition" id="index-12">
<p class="first admonition-title">Todo</p>
<p class="last">20181224</p>
</div>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="external_feature_derivations.DerivedFeatureExtractorV0.t_delay">
<code class="descname">t_delay</code><a class="headerlink" href="#external_feature_derivations.DerivedFeatureExtractorV0.t_delay" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates the tangential time delay between the arrival of the primary peak
and the multiple peak. Here we are using polynomial fits so we are not
so ‘blocky’.  The label for this feature is 1810_tangential_delay.</p>
<blockquote>
<div><div class="line-block">
<div class="line">tangential_delay = tangential_multiple1_time_poly - tangential_primary_time_poly</div>
</div>
</div></blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>None</strong> – </p>
</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">Other Parameters:</th></tr>
<tr class="field-even field"><td>&#160;</td><td class="field-body"><ul class="first simple">
<li><strong>1810_tangential_primary_time_poly</strong> (<em>float</em>) – arrival time of the primary
peak along the tangential component</li>
<li><strong>1810_tangential_multiple1_time_poly</strong> (<em>float</em>) – arrival time of the first
multiple peak along the tangential component</li>
</ul>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><dl class="docutils">
<dt><strong>t_delay</strong>, the time betweent the arrival of the primary</dt>
<dd><p class="first last">and first multiple peaks along the tangential component.</p>
</dd>
</dl>
</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">(float)</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="external_feature_derivations.DerivedFeatureExtractorV0.t_amplitude_ratio">
<code class="descname">t_amplitude_ratio</code><a class="headerlink" href="#external_feature_derivations.DerivedFeatureExtractorV0.t_amplitude_ratio" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates the ratio between the primary peak amplitude and the
multiple peak amplitude on the tangential component.</p>
<blockquote>
<div><div class="line-block">
<div class="line">tangential_amplitude_ratio =  ‘tangential_multiple1_amplitude_poly’ / ‘tangential_primary_amplitude_poly’</div>
</div>
</div></blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>None</strong> – </p>
</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">Other Parameters:</th></tr>
<tr class="field-even field"><td>&#160;</td><td class="field-body"><ul class="first last simple">
<li><strong>feature version</strong> (<em>str</em>) – version of extractor deriver (here: ‘1810’)</li>
<li><strong>tangential_primary_amplitude_poly</strong> (<em>float</em>) – value of primary peak amplitude
from dataframe “df”</li>
<li><strong>tangential_multiple1_amplitude_poly</strong> (<em>float</em>) – value of multiple peak amplitude
from dataframe “df”</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>Returns</dt>
<dd>(float): <strong>t_amplitude_ratio</strong>, the ratio between the primary peak
amplitude and the multiple peak amplitude</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This was calculated in the 1810 features, but because it is not a derived
quantity I would rather calculate it here.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">1810 features were applying a square root to the amplitude ratio;
fixed here.</p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="external_feature_derivations.DerivedFeatureExtractorV0.t_reflection_coef">
<code class="descname">t_reflection_coef</code><a class="headerlink" href="#external_feature_derivations.DerivedFeatureExtractorV0.t_reflection_coef" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates the reflection coefficient between the drill/rock interface
from the tangential primary and multiple peaks.</p>
<blockquote>
<div><div class="line-block">
<div class="line">t_reflection_coef: (1-R) / (1+R)</div>
</div>
</div></blockquote>
<p>Where R is the multiple-to-primary-amplitude ratio (tangential)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>None</strong> – </td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">Other Parameters:</th></tr>
<tr class="field-even field"><td>&#160;</td><td class="field-body"><strong>t_amplitude_ratio</strong> (<em>float</em>) – calculated in <code class="xref py py-meth docutils literal notranslate"><span class="pre">t_amplitude_ratio()</span></code></td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">the reflection coefficient from tangential component features</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">(float)</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="external_feature_derivations.DerivedFeatureExtractorV0.t_mod">
<code class="descname">t_mod</code><a class="headerlink" href="#external_feature_derivations.DerivedFeatureExtractorV0.t_mod" title="Permalink to this definition">¶</a></dt>
<dd><p>Scales the reflection coefficient based on drill setup to find modulus,</p>
<blockquote>
<div><div class="line-block">
<div class="line">t_mod:  k2 * t_reflection_coef</div>
</div>
</div></blockquote>
<p>Not previously calculated, just plotted as reflection_coef, i.e. k1=1.0;
k2 a constant to be determined; may depend on MWD.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>None</strong> – </td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">Other Parameters:</th></tr>
<tr class="field-even field"><td>&#160;</td><td class="field-body"><strong>t_reflection_coef</strong> (<em>float</em>) – calculated in <code class="xref py py-meth docutils literal notranslate"><span class="pre">t_reflection_coef()</span></code></td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><strong>t_mod</strong>, the modulus from tangential component features</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">(float)</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="external_feature_derivations.DerivedFeatureExtractorV0.t_vel">
<code class="descname">t_vel</code><a class="headerlink" href="#external_feature_derivations.DerivedFeatureExtractorV0.t_vel" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates the relative velocity of the tangential wave using the inverse of
t_delay. This is the “delay velocity”.  It is the one that has been ‘blocky’
in the past</p>
<blockquote>
<div><div class="line-block">
<div class="line">t_vel:  1 / t_delay</div>
</div>
</div></blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>None</strong> – </td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">Other Parameters:</th></tr>
<tr class="field-even field"><td>&#160;</td><td class="field-body"><strong>t_delay</strong> (<em>float</em>) – calculated in <code class="xref py py-meth docutils literal notranslate"><span class="pre">t_delay()</span></code></td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><strong>t_vel</strong>, the delay velocity calculated from the tangential component</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">(float)</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This does not take into account the distance from instrument
to tip, so this is not absolute velocity but delay velocity</p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="external_feature_derivations.DerivedFeatureExtractorV0.s_modulus">
<code class="descname">s_modulus</code><a class="headerlink" href="#external_feature_derivations.DerivedFeatureExtractorV0.s_modulus" title="Permalink to this definition">¶</a></dt>
<dd><p>This will be some scaled version of t_mod, for now we set equal to t_mod</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body"><div class="admonition-todo first last admonition" id="index-13">
<p class="first admonition-title">Todo</p>
<p class="last">20181224</p>
</div>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="external_feature_derivations.DerivedFeatureExtractorV0.s_velocity">
<code class="descname">s_velocity</code><a class="headerlink" href="#external_feature_derivations.DerivedFeatureExtractorV0.s_velocity" title="Permalink to this definition">¶</a></dt>
<dd><p>This will be some scaled version of t_vel, for now we set equal to t_vel</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body"><div class="admonition-todo first last admonition" id="index-14">
<p class="first admonition-title">Todo</p>
<p class="last">20181224</p>
</div>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="external_feature_derivations.extracted_features_df_to_external_features">
<code class="descname">extracted_features_df_to_external_features</code><span class="sig-paren">(</span><em>extracted_features</em><span class="sig-paren">)</span><a class="headerlink" href="#external_feature_derivations.extracted_features_df_to_external_features" title="Permalink to this definition">¶</a></dt>
<dd><p>Consolidates derived features and adds them to already extracted features.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>extracted_features</strong> (<em>dataframe</em>) – the features extracted prior to derived features</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">Other Parameters:</th></tr>
<tr class="field-even field"><td>&#160;</td><td class="field-body"><ul class="first simple">
<li><strong>a_delay</strong> (<em>float</em>) – found here <code class="xref py py-meth docutils literal notranslate"><span class="pre">a_delay()</span></code></li>
<li><strong>a_dens</strong> (<em>float</em>) – found here <code class="xref py py-meth docutils literal notranslate"><span class="pre">a_dens()</span></code></li>
<li><strong>a_mod</strong> (<em>float</em>) – found here <code class="xref py py-meth docutils literal notranslate"><span class="pre">a_mod()</span></code></li>
<li><strong>a_reflection_coef</strong> (<em>float</em>) – found here <code class="xref py py-meth docutils literal notranslate"><span class="pre">a_reflection_coef()</span></code></li>
<li><strong>a_vel</strong> (<em>float</em>) – found here <code class="xref py py-meth docutils literal notranslate"><span class="pre">a_vel()</span></code></li>
<li><strong>c_modulus</strong> (<em>float</em>) – found here <code class="xref py py-meth docutils literal notranslate"><span class="pre">c_modulus()</span></code></li>
<li><strong>c_strength</strong> (<em>float</em>) – found here <code class="xref py py-meth docutils literal notranslate"><span class="pre">c_strength()</span></code></li>
<li><strong>c_velocity</strong> (<em>float</em>) – found here <code class="xref py py-meth docutils literal notranslate"><span class="pre">c_velocity()</span></code></li>
<li><strong>c_density</strong> (<em>float</em>) – found here <code class="xref py py-meth docutils literal notranslate"><span class="pre">c_density()</span></code></li>
<li><strong>t_delay</strong> (<em>float</em>) – found here <code class="xref py py-meth docutils literal notranslate"><span class="pre">t_delay()</span></code></li>
<li><strong>t_mod</strong> (<em>float</em>) – found here <code class="xref py py-meth docutils literal notranslate"><span class="pre">t_mod()</span></code></li>
<li><strong>t_reflection_coef</strong> (<em>float</em>) – found here <code class="xref py py-meth docutils literal notranslate"><span class="pre">t_reflection_coef()</span></code></li>
<li><strong>s_modulus</strong> (<em>float</em>) – found here <code class="xref py py-meth docutils literal notranslate"><span class="pre">s_modulus()</span></code></li>
<li><strong>s_velocity</strong> (<em>float</em>) – found here <code class="xref py py-meth docutils literal notranslate"><span class="pre">s_velocity()</span></code></li>
</ul>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>output_features</strong>, dataframe of extracted features and
derived features</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">(dataframe)</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="external_feature_derivations.test">
<code class="descname">test</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#external_feature_derivations.test" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="external_feature_derivations.main">
<code class="descname">main</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#external_feature_derivations.main" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div></blockquote>
</div>
<div class="section" id="intermediate">
<h3>Intermediate<a class="headerlink" href="#intermediate" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><span class="target" id="module-intermediate_derived_features"></span><p>Author: kkappler</p>
<div class="admonition-todo admonition" id="index-15">
<p class="first admonition-title">Todo</p>
<p class="last">20190220: The features extracted here are not pulled directly from wavelets, so
we refer to them as derived features rather than ‘direct’ features.  THey
will in future versions of the rhino software be superceded log processing,
and possibly reinstututed once log-processing and calibrations are better understood.</p>
</div>
<dl class="class">
<dt id="intermediate_derived_features.IntermediateFeatureDeriver">
<em class="property">class </em><code class="descname">IntermediateFeatureDeriver</code><span class="sig-paren">(</span><em>df_dict=None</em><span class="sig-paren">)</span><a class="headerlink" href="#intermediate_derived_features.IntermediateFeatureDeriver" title="Permalink to this definition">¶</a></dt>
<dd><p>Derives the following features:</p>
<blockquote>
<div><ul class="simple">
<li>axial_primary_peak</li>
<li>axial_amplitude_ratio_1</li>
<li>axial_amplitude_ratio_2</li>
<li>axial_reflection_coefficient_1</li>
<li>axial_reflection_coefficient_2</li>
<li>axial_delay_1</li>
<li>axial_delay_2</li>
<li>axial_pseudo_velocity_1</li>
<li>axial_pseudo_velocity_2</li>
<li>pseudo_ucs</li>
<li>pseudo_density</li>
<li>tangential_primary_peak</li>
<li>tangential_primary_peak_time</li>
<li>tangential_delay_1</li>
<li>tangential_delay_2</li>
<li>tangential_amplitude_ratio_1</li>
<li>tangential_amplitude_ratio_2</li>
<li>tangential_reflection_coefficient_1</li>
<li>tangential_reflection_coefficient_2</li>
<li>tangential_pseudo_velocity_1</li>
</ul>
</div></blockquote>
<dl class="method">
<dt id="intermediate_derived_features.IntermediateFeatureDeriver.derive_features">
<code class="descname">derive_features</code><span class="sig-paren">(</span><em>component_id</em><span class="sig-paren">)</span><a class="headerlink" href="#intermediate_derived_features.IntermediateFeatureDeriver.derive_features" title="Permalink to this definition">¶</a></dt>
<dd><p>Store certain features in dictionary, based on component_id.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>component_id</strong> (<em>str</em>) – axial/tangential</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">derived features<blockquote>
<div>For axial:<blockquote>
<div><ul class="simple">
<li>pseudo ucs</li>
<li>axial pseudo velocity 1</li>
<li>pseudo density</li>
<li>axial reflection coeff</li>
</ul>
</div></blockquote>
<p>For tangential:</p>
<blockquote>
<div><ul class="simple">
<li>tangential reflection coeff 1</li>
<li>tangential reflection coeff 2</li>
<li>tangential delay 1</li>
<li>tangential pseudo velocity 1</li>
</ul>
</div></blockquote>
</div></blockquote>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">(dict)</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div></blockquote>
</div>
</div>
<div class="section" id="support">
<h2>Support<a class="headerlink" href="#support" title="Permalink to this headline">¶</a></h2>
<div class="section" id="j1">
<h3>j1<a class="headerlink" href="#j1" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><span class="target" id="module-supporting_j1"></span><p>Created on Tue Dec 11 in Houston at #206 - 300 St. Joseph’s Parkway
Based on earlier versions from Dec 5, Dec 6</p>
<p>Author: kkappler</p>
<dl class="function">
<dt id="supporting_j1.get_expected_multiple_times">
<code class="descname">get_expected_multiple_times</code><span class="sig-paren">(</span><em>global_config</em>, <em>recipe='J1'</em><span class="sig-paren">)</span><a class="headerlink" href="#supporting_j1.get_expected_multiple_times" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates the time_intervals between resonances along the pipe for each of P and S
waves, axial and tangential components.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>global_config</strong> (<em>Dataframe</em>) – metadata on drilling apparatus (distances etc.)</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">Other Parameters:</th></tr>
<tr class="field-even field"><td>&#160;</td><td class="field-body"><strong>recipe</strong> (<em>str</em>) – set to ‘J1’ to use j1 extractor</td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">expected multiple periods (only first and second) and their locations</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">(dict)</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="supporting_j1.set_window_boundaries_in_time">
<code class="descname">set_window_boundaries_in_time</code><span class="sig-paren">(</span><em>expected_multiple_periods</em>, <em>window_widths</em>, <em>component</em>, <em>primary_shift=0.0</em><span class="sig-paren">)</span><a class="headerlink" href="#supporting_j1.set_window_boundaries_in_time" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets t0, t1, returns window bounds in seconds. Primary period
extends from primary_shift=0.0 to ?[start of first multiple’s period]</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>expected_multiple_periods</strong> (<em>dict</em>) – calculated in <a class="reference internal" href="#supporting_j1.get_expected_multiple_times" title="supporting_j1.get_expected_multiple_times"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_expected_multiple_times()</span></code></a></li>
<li><strong>window_widths</strong> – with (dict) component containing (key) window_lable</li>
<li><strong>component</strong> (<em>str</em>) – axial/tangential</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">Other Parameters:</th></tr>
<tr class="field-even field"><td>&#160;</td><td class="field-body"><p class="first last"><strong>primary_shift</strong> (<em>float</em>) – offset of primary peak</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">the noise_1 and noise_2 windows depend on that the multiple windows have
been defined previously, this is handled by trace_window_labels_for_feature_extraction
giving the multiples before the noise variables … this is not robust.  I’m not
sure of a better way to do this right now</p>
</div>
</dd></dl>

<dl class="function">
<dt id="supporting_j1.update_window_boundaries_in_time">
<code class="descname">update_window_boundaries_in_time</code><span class="sig-paren">(</span><em>component, trimmed_trace, trimmed_time_vector, window_widths, expected_multiple_periods, global_config, dynamic_windows=['primary']</em><span class="sig-paren">)</span><a class="headerlink" href="#supporting_j1.update_window_boundaries_in_time" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the window boundaries if dynamic windows is true. Grab the primary
trace and find its max, make sure this is no more than a few samples from
t=0, adjust window_boundaries_time to new times, then adjust the indices</p>
<p><strong>Dynamic Window Allocation</strong> idea is that the primary window will depend on
the data, not an predetermined expected window assignment
window_boundaries_time, window_boundaries_indices = update_window_boundaries(trimmed_trace,
trimmed_time_vector, window_boundaries_time, window_boundaries_indices)</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">acceptable_peak_wander = .003 #3ms</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><em>Requires</em> applicable_window_width, for which I need to know what component I am on</p>
</div>
</dd></dl>

<dl class="function">
<dt id="supporting_j1.convert_window_boundaries_to_sample_indices">
<code class="descname">convert_window_boundaries_to_sample_indices</code><span class="sig-paren">(</span><em>component_label</em>, <em>global_config</em><span class="sig-paren">)</span><a class="headerlink" href="#supporting_j1.convert_window_boundaries_to_sample_indices" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes a dictionary of times as input, returns modified dictionary of same shape.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>component_label</strong> – </li>
<li><strong>global_config</strong> (<em>Dataframe</em>) – metadata on drilling apparatus (distances etc.)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">a dictioanry of same shape, but [t0, t1] replaced by [ndx0, ndx1]</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">(dict)</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition-todo admonition" id="index-16">
<p class="first admonition-title">Todo</p>
<p class="last">Spruce this up by using iterative dictionary comprehension</p>
</div>
<div class="admonition-todo admonition" id="index-17">
<p class="first admonition-title">Todo</p>
<p class="last">20181226, removed window_boundaries_time from input, replaced with global WINDOW_BOUNDARIES_TIME</p>
</div>
</dd></dl>

<dl class="function">
<dt id="supporting_j1.populate_window_data_dict">
<code class="descname">populate_window_data_dict</code><span class="sig-paren">(</span><em>component</em>, <em>trimmed_trace</em>, <em>trimmed_time_vector</em><span class="sig-paren">)</span><a class="headerlink" href="#supporting_j1.populate_window_data_dict" title="Permalink to this definition">¶</a></dt>
<dd><p>Associate with each window_label, the data in that window, and the time
takes a dictionary of times as input.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">a dictionary of same keys, but [ndx0, ndx1] replaced by data_series</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">(dict)</td>
</tr>
</tbody>
</table>
<div class="admonition-todo admonition" id="index-18">
<p class="first admonition-title">Todo</p>
<p class="last">Spruce this up by using iterative dictionary comprehension</p>
</div>
<div class="admonition-todo admonition" id="index-19">
<p class="first admonition-title">Todo</p>
<p class="last">time vector splitting is redundant -  calulate once outside here?</p>
</div>
</dd></dl>

<dl class="function">
<dt id="supporting_j1.test_populate_window_data_dict">
<code class="descname">test_populate_window_data_dict</code><span class="sig-paren">(</span><em>trace_data_window_dict</em>, <em>trace_time_vector_dict</em>, <em>trimmed_trace</em>, <em>trimmed_time_vector</em><span class="sig-paren">)</span><a class="headerlink" href="#supporting_j1.test_populate_window_data_dict" title="Permalink to this definition">¶</a></dt>
<dd><p>Plot the trace in black line and multicolor scatter, label axis/legend, show.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>trace_data_window_dict</strong> (<em>dict</em>) – trace data</li>
<li><strong>trace_time_vector_dict</strong> (<em>dict</em>) – trace time data</li>
<li><strong>trimmed_trace</strong> – 1D trace data (to be plotted)</li>
<li><strong>trimmed_time_vector</strong> – 1D trace time data (to be plotted)</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="supporting_j1.extract_features_from_each_window">
<code class="descname">extract_features_from_each_window</code><span class="sig-paren">(</span><em>window_data_dict</em>, <em>time_vector_dict</em><span class="sig-paren">)</span><a class="headerlink" href="#supporting_j1.extract_features_from_each_window" title="Permalink to this definition">¶</a></dt>
<dd><p>Feature extractor that moves window by window, finds features, and
stores them under window label. Calc’s the following and gives them to
intermediate feature deriver.</p>
<blockquote>
<div><ul class="simple">
<li>max_amplitude</li>
<li>max_time</li>
<li>min_amplitude</li>
<li>min_time</li>
<li>integrated_absolute_amplitude</li>
</ul>
</div></blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>window_data_dict</strong> (<em>dict</em>) – window labels, time_boundaries dictionary</li>
<li><strong>time_vector_dict</strong> (<em>dict</em>) – dictionary of time_vectors for each window_label</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">dictionary (unnested) from IntermediateFeatureDeriver</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">(dict)</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="supporting_j1.calculate_boolean_features">
<code class="descname">calculate_boolean_features</code><span class="sig-paren">(</span><em>feature_dict</em>, <em>global_config</em><span class="sig-paren">)</span><a class="headerlink" href="#supporting_j1.calculate_boolean_features" title="Permalink to this definition">¶</a></dt>
<dd><p>Create Boolean and configure calculation for feature extraction, Output dictionary
contains the following boolean values:</p>
<blockquote>
<div><ul class="simple">
<li>mask_system_noise_level</li>
<li>mask_snr_mult1</li>
</ul>
</div></blockquote>
<p>Based on:</p>
<div class="line-block">
<div class="line">1 Min = sensitivity (g) /2000</div>
<div class="line">2 S/N 1st Multiple &gt; 1</div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>feature_dict</strong> (<em>dict</em>) – feature dictionary</li>
<li><strong>sensor_saturation_g</strong> (<em>float</em>) – sensor saturation value</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">dictionary of booleans to be usedin feature extraction</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">(dict)</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">feature_dict here is a subdictionary, we are working with a single component</p>
</div>
</dd></dl>

<dl class="function">
<dt id="supporting_j1.main">
<code class="descname">main</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#supporting_j1.main" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div></blockquote>
</div>
<div class="section" id="minimal-extraction">
<h3>Minimal Extraction<a class="headerlink" href="#minimal-extraction" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><span class="target" id="module-supporting_minimal_feature_extraction"></span><p>Created on Thu Aug  2 16:25:58 2018</p>
<p>&#64;author: kkappler</p>
<dl class="function">
<dt id="supporting_minimal_feature_extraction.get_wavelet_window_indices">
<code class="descname">get_wavelet_window_indices</code><span class="sig-paren">(</span><em>time_vector</em>, <em>start_time</em>, <em>end_time</em><span class="sig-paren">)</span><a class="headerlink" href="#supporting_minimal_feature_extraction.get_wavelet_window_indices" title="Permalink to this definition">¶</a></dt>
<dd><div class="admonition-todo admonition" id="index-20">
<p class="first admonition-title">Todo</p>
<p class="last">20170823: this intended to replace variations on method from primary, multiple_peak_finder, multiple_refined,
Here start and end times are intended to be floats</p>
</div>
</dd></dl>

<dl class="class">
<dt id="supporting_minimal_feature_extraction.WaveletForFeatureExtraction">
<em class="property">class </em><code class="descname">WaveletForFeatureExtraction</code><span class="sig-paren">(</span><em>data</em>, <em>time_vector</em>, <em>wavelet_features</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#supporting_minimal_feature_extraction.WaveletForFeatureExtraction" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates features on individual wavelets.  Actually
the data here are “windows”.  we think there are wavelets in these windows
much of the time.</p>
</dd></dl>

<dl class="function">
<dt id="supporting_minimal_feature_extraction.extract_features_from_primary_wavelet">
<code class="descname">extract_features_from_primary_wavelet</code><span class="sig-paren">(</span><em>tr</em>, <em>primary_window_halfwidth_ms</em>, <em>component</em>, <em>wavelet_type</em>, <em>wavelet_features</em><span class="sig-paren">)</span><a class="headerlink" href="#supporting_minimal_feature_extraction.extract_features_from_primary_wavelet" title="Permalink to this definition">¶</a></dt>
<dd><p>Search a region near lag=0 (t=0) for the primary-peak, in two steps:</p>
<blockquote>
<div><ul class="simple">
<li>step 1: find a local maxima</li>
<li>step 2: center on the local maxima</li>
</ul>
</div></blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>tr</strong> (<em>Dataframe</em>) – TrimmedCorrelatedTracePacket()</li>
<li><strong>primary_window_halfwidth_ms</strong> (<em>float</em>) – (~3ms) this is the expected half width of the primary
peak, it can be approximate, we use it to define a chunk of the trace_data
where we expect the primary peak to live.</li>
<li><strong>component</strong> (<em>str</em>) – axial/tangential (to save values)</li>
<li><strong>wavelet_type</strong> (<em>str</em>) – </li>
<li><strong>wavelet_features</strong> – </li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">Other Parameters:</th></tr>
<tr class="field-even field"><td>&#160;</td><td class="field-body"><p class="first"><strong>primary_wavelet_indices_1</strong> (<em>list</em>) – these are the indices of the data array used to extract
the primary wavelet search region</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Dataframe ‘waveletforfeatureextraction’</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">(Dataframe)</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition-todo admonition" id="index-21">
<p class="first admonition-title">Todo</p>
<p class="last">migrate this to seismic processing eventually</p>
</div>
</dd></dl>

<dl class="function">
<dt id="supporting_minimal_feature_extraction.extract_features_from_multiple_wavelet">
<code class="descname">extract_features_from_multiple_wavelet</code><span class="sig-paren">(</span><em>tr</em>, <em>time_vector</em>, <em>earliest_multiple_time</em>, <em>latest_multiple_time</em>, <em>component</em>, <em>wavelet_type</em>, <em>wavelet_features</em><span class="sig-paren">)</span><a class="headerlink" href="#supporting_minimal_feature_extraction.extract_features_from_multiple_wavelet" title="Permalink to this definition">¶</a></dt>
<dd><p>Search a region near lag=0 (t=0) for the primary-peak, in two steps:</p>
<blockquote>
<div><ul class="simple">
<li>step 1: find a local maxima</li>
<li>step 2: center on the local maxima</li>
</ul>
</div></blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>tr</strong> (<em>Dataframe</em>) – TrimmedCorrelatedTracePacket()</li>
<li><strong>earliest_multiple_time</strong> (<em>float</em>) – the earliest time expected to contain the multiple peak</li>
<li><strong>latest_multiple_time</strong> (<em>float</em>) – the latest time expected to contain the multiple peak</li>
<li><strong>component</strong> (<em>str</em>) – axial/tangential (to save values)</li>
<li><strong>wavelet_type</strong> (<em>str</em>) – </li>
<li><strong>wavelet_features</strong> – </li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">Other Parameters:</th></tr>
<tr class="field-even field"><td>&#160;</td><td class="field-body"><p class="first"><strong>multiple_wavelet_indices_1</strong> (<em>list</em>) – these are the indices of the data array used to extract
the multiple wavelet search region</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Dataframe ‘waveletforfeatureextraction’</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">(Dataframe)</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition-todo admonition" id="index-22">
<p class="first admonition-title">Todo</p>
<p class="last">migrate this to seismic processing eventually</p>
</div>
<div class="admonition-todo admonition" id="index-23">
<p class="first admonition-title">Todo</p>
<p class="last">Once ROBUST can probably use same routine for PRIM and MULT</p>
</div>
</dd></dl>

<dl class="function">
<dt id="supporting_minimal_feature_extraction.my_function">
<code class="descname">my_function</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#supporting_minimal_feature_extraction.my_function" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="supporting_minimal_feature_extraction.main">
<code class="descname">main</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#supporting_minimal_feature_extraction.main" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div></blockquote>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/DC_Logo_Padded.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Feature Extraction</a><ul>
<li><a class="reference internal" href="#extraction">Extraction</a><ul>
<li><a class="reference internal" href="#k0-extractor">k0 Extractor</a></li>
<li><a class="reference internal" href="#j1a-extractor">j1a Extractor</a></li>
<li><a class="reference internal" href="#j0-extractor">j0 Extractor</a></li>
<li><a class="reference internal" href="#b0-extractor">b0 Extractor</a></li>
</ul>
</li>
<li><a class="reference internal" href="#derivation">Derivation</a><ul>
<li><a class="reference internal" href="#external">External</a></li>
<li><a class="reference internal" href="#intermediate">Intermediate</a></li>
</ul>
</li>
<li><a class="reference internal" href="#support">Support</a><ul>
<li><a class="reference internal" href="#j1">j1</a></li>
<li><a class="reference internal" href="#minimal-extraction">Minimal Extraction</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/module_docs/featdoc.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="plotdoc.html" title="Plotting Data"
             >next</a> |</li>
        <li class="right" >
          <a href="featdir.html" title="Python Helpers"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">DataCloud Rhino 1.0 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, DataCloud.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.2.
    </div>
  </body>
</html>